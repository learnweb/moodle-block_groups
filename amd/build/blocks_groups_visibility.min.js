/**
 * Javascript module for block_groups
 *
 * @module     block_groups
 * @copyright  2016/17 N Herrmann
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_groups/blocks_groups_visibility",["jquery","core/ajax","core/url","core/notification","core/str"],(function($,ajax,url,notification,str){var removeWarning=function(identifier){$(".block_groups").find(".warning"+identifier).remove()},removeSpinner=function(groupid){var divgroup=$(".block_groups");divgroup.find(".spinner"+groupid).remove(),divgroup.find(".imggroup-"+groupid).show()},removeSpinners=function(){var divgroups=$(".block_groups");divgroups.find(".spinner-all").remove(),divgroups.find(".imggroup").show()},reloadPage=function(){location.reload(!0)},createWarningMessage=function(){str.get_strings([{key:"errortitle",component:"block_groups"},{key:"nochangeindatabasepossiblereload",component:"block_groups"},{key:"yes"},{key:"no"}]).done((function(s){notification.confirm(s[0],s[1],s[2],s[3],reloadPage)})).fail(notification.exception)},addWarning=function(identifier){var divgroups=$(".block_groups");if(divgroups.find(".warning"+identifier).length)return removeSpinner(identifier),!1;"all"===identifier?removeSpinners():removeSpinner(identifier);var imgurl=url.imageUrl("i/warning","moodle"),warning=document.createElement("img");return warning.className="warning"+identifier+" block-groups-warning",warning.src=imgurl,createWarningMessage(),divgroups.find(".imggroup-"+identifier).before(warning),divgroups.find(".imggroup-"+identifier).on("click",createWarningMessage),divgroups.find(".warning"+identifier).on("click",createWarningMessage),!1},changevisibility=function(event){var divgroups=$(".block_groups"),groupid=$(this).data("groupid");if(divgroups.find(".spinner"+$(this).data("groupid")).length>0||divgroups.find(".spinner-all").length>0)return!1;!function(groupid){var divgroups=$(".block_groups");divgroups.find(".warning"+groupid).length>0&&removeWarning(groupid);var imgurl=url.imageUrl("i/loading_small","moodle"),spinner=document.createElement("img");spinner.className="spinner"+groupid+" spinner block-groups-spinner",spinner.src=imgurl,spinner.hidden=!1,divgroups.find(".imggroup-"+groupid).before(spinner),divgroups.find(".imggroup-"+groupid).hide()}($(this).data("groupid"));var promises=ajax.call([{methodname:"block_groups_create_output",args:{groups:{id:$(this).data("groupid"),courseid:event.data.courseid}}}]);return $(document).ajaxError((function(){return addWarning(groupid),!1})),promises[0].then((function(response){return null===response||!0===response.error?(addWarning(groupid),!1):(divgroups.find(".group-"+response.id).replaceWith(response.newelement),0===response.visibility&&divgroups.find(".membergroup-"+response.id).removeClass("hiddengroups"),1===response.visibility&&divgroups.find(".membergroup-"+response.id).addClass("hiddengroups"),divgroups.find(".group-"+response.id+" .block_groups_toggle").on("click",{courseid:event.data.courseid},changevisibility),removeSpinner(response.id),!1)})).fail((function(){return addWarning(groupid),!1})),!1},addNotification=function(type,text){notification.addNotification({message:text,type:type})},changeVisibilityAll=function(event){if($(".block_groups").find(".spinner").length>0)return!1;var warningexist=$(".block_groups").find(".block-groups-warning");if(void 0!==warningexist&&warningexist.length>0)return addWarning("all"),!1;!function(){var divgroups=$(".block_groups");divgroups.find(".warningall").length>0&&removeWarning("all");var imgurl=url.imageUrl("i/loading_small","moodle"),spinner=document.createElement("img");spinner.className="spinner-all spinner block-groups-spinner",spinner.src=imgurl,spinner.hidden=!1,divgroups.find(".imggroup").before(spinner),divgroups.find(".imggroup").hide()}();var promises=ajax.call([{methodname:"block_groups_create_allgroups_output",args:{groups:{action:$(this).data("action"),courseid:event.data.courseid}}}]);return $(document).ajaxError((function(){return addWarning("all"),!1})),promises[0].then((function(response){var divgroups=$(".block_groups");return null===response||!0===response.error?(addWarning("all"),!1):0===response.visibility?(divgroups.find(".content").replaceWith(response.newelement),str.get_strings([{key:"nogroups",component:"block_groups"}]).done((function(s){addNotification("error",s[0])})).fail(notification.exception),!1):(divgroups.find(".wrapperlistgroup").replaceWith(response.newelement),divgroups.find(".block_groups_toggle").on("click",{courseid:event.data.courseid},changevisibility),function(response){var membergroup=$(".block-groups-membergroup"),visibility=response.visibility;2===visibility&&membergroup.removeClass("hiddengroups"),1===visibility&&membergroup.addClass("hiddengroups")}(response),str.get_strings([{key:"groupschangedhidden",component:"block_groups"},{key:"groupschangedvisible",component:"block_groups"},{key:"allgroupsinstatehidden",component:"block_groups"},{key:"allgroupsinstatevisible",component:"block_groups"}]).done((function(s){switch(response.visibility){case 1:addNotification("success",s[0]);break;case 2:addNotification("success",s[1]);break;case 3:addNotification("warning",s[2]);break;case 4:addNotification("warning",s[3])}})).fail(notification.exception),!1)})).fail((function(){return addWarning("all"),!1})),removeSpinners(),!1};return{initialise:function(courseid){$(".block_groups_toggle").on("click",{courseid:courseid},changevisibility),$(".block_groups_all_toggle").on("click",{courseid:courseid},changeVisibilityAll)}}}));

//# sourceMappingURL=blocks_groups_visibility.min.js.map